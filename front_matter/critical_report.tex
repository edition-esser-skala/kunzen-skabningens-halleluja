\documentclass[parskip=full]{scrreprt}

\RedeclareSectionCommand[pagestyle=plain,afterskip=10pt plus 1pt]{chapter}
\setkomafont{chapter}{\mdseries\headingfont\fontsize{40}{40}\selectfont\color{black!80}}
\setkomafont{pageheadfoot}{\normalsize}

\def\pnumbox#1{#1\hspace*{9cm}}
\DeclareTOCStyleEntry[
  indent=0pt,
  entrynumberformat=\textcolor{oldred},
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox,
  pagenumberformat=\itshape
]{tocline}{section}

\usepackage[english]{babel}

\usepackage{fontspec}

\setmainfont{Source Sans Pro}[
  ItalicFont = Source Sans Pro Italic,
  BoldFont = Source Sans Pro Bold,
  BoldItalicFont = Source Sans Pro Bold Italic,
  FontFace = {lt}{n}{Source Sans Pro Light},
  FontFace = {lt}{it}{Source Sans Pro Light Italic},
  FontFace = {sb}{n}{Source Sans Pro Semibold},
  FontFace = {sb}{it}{Source Sans Pro Semibold Italic},
  Numbers = Proportional,
  Ligatures = Common
]
\DeclareRobustCommand{\ltseries}{\fontseries{lt}\selectfont}
\DeclareRobustCommand{\sbseries}{\fontseries{sb}\selectfont}
\DeclareTextFontCommand{\textlt}{\ltseries}
\DeclareTextFontCommand{\textsb}{\sbseries}

\newfontfamily\headingfont{Fredericka the Great}

\usepackage[pass]{geometry}
\newgeometry{twoside,inner=20mm,outer=40mm,top=20mm,bottom=40mm}

\usepackage{url}
\urlstyle{same}

\usepackage{microtype}
\microtypesetup{verbose=silent}

\usepackage{booktabs,array,longtable}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\usepackage{graphicx}

\usepackage{xcolor}
\definecolor{oldred}{rgb}{.8313,0,0}

\usepackage{pdfpages}

\usepackage{multicol}

\usepackage{scrlayer-scrpage}
\pagestyle{scrheadings}
\clearscrheadfoot
\cfoot[\thepage]{\thepage}
\pagenumbering{roman}


\makeatletter

\newcommand\fancytitlehead{
	\headingfont%
	\fontsize{80}{80}\selectfont\textcolor{black!80}{\@lastname.}\\[15pt]%
	\fontsize{60}{60}\selectfont\@ifundefined{@shorttitle}{\@title}{\@shorttitle}.%
}


\def\firstname#1{\def\@firstname{#1}}
\def\lastname#1{\def\@lastname{#1}}
\def\shorttitle#1{\def\@shorttitle{#1}}
\def\namesuffix#1{\def\@namesuffix{#1}}
\def\instrumentation#1{\def\@instrumentation{#1}}
\def\parts#1{\def\@parts{#1}}

\firstname{\relax}
\lastname{\relax}
\namesuffix{\relax}
\instrumentation{\relax}
\parts{\relax}


\def\maketitle{%
\begin{titlepage}%
	\Large%
	{\@titlehead}%
	\vfill%
	{\strut\@firstname}\\%
	{\sbseries\color{oldred}\strut\@lastname}\\%
	{\strut\@namesuffix}%
	\vfill%
	{\sbseries\@title}\\%
	{\@subtitle}\\[\baselineskip]%
	{\itshape\@instrumentation}%
	\vfill%
	{\itshape\@parts}\hspace*{\fill}\raisebox{0pt}[0pt][0pt]{\includegraphics{ees_logo}}%
\end{titlepage}%
}


\newif\iftemplate\templatetrue
\newif\ifprintreport\printreportfalse
\directlua{
scores = {
  cl1 = "Clarinetto I",
  cl2 = "Clarinetto II",
  fag1 = "Fagotto I",
  fag2 = "Fagotto II",
  ottoni = "Corno I, II\string\\newline Tromba I, II\string\\newline Timpani",
  trb123 = "Trombone I, II, III",
  vl1 = "Violino I",
  vl2 = "Violino II",
  vla = "Viola",
  coro = "Coro",
  org = "Organo",
  b = "Bassi",
  full_score = "Full Score"
}

last_arg = arg[\string#arg]
texio.write("Last argument: " .. last_arg)
if not (scores[last_arg] == nil) then
  tex.print("\string\\def\string\\lypdfname{" .. last_arg .. "}")
  tex.print("\string\\parts{" .. scores[last_arg] .. "}")
  if (last_arg == "full_score") then
    tex.print("\string\\printreporttrue")
  end
end
}

\@ifundefined{lypdfname}{%
  \templatefalse
  \printreporttrue
  \parts{Draft}
}{\templatetrue}

\def\@firstoffour#1#2#3#4{#1}
\def\@secondoffour#1#2#3#4{#2}
\def\@thirdoffour#1#2#3#4{#3}
\def\@lastoffour#1#2#3#4{#4}
\def\lyrefnumber#1{\expandafter\@setref\csname r@#1\endcsname\@firstoffour{#1}}
\def\lyreftitle#1{\expandafter\@setref\csname r@#1\endcsname\@secondoffour{#1}}
\def\lyreftitledansk#1{\expandafter\@setref\csname r@#1\endcsname\@thirdoffour{#1}}
\def\lyrefpage#1{\expandafter\@setref\csname r@#1\endcsname\@lastoffour{#1}}
\def\lyref#1{%
  \begingroup%
  \@tempdima.5\linewidth\relax%
  \advance\@tempdima.5\columnsep\relax%
  \sbseries%
  \makebox[0pt][r]{\color{oldred}\lyrefnumber{#1}\hspace*{1.5em}}%
  \makebox[\@tempdima][l]{\lyreftitle{#1}\Dotfill}%
  \textit{\lyreftitledansk{#1}}%
  \Dotfill\lyrefpage{#1}%
  \endgroup%
}

\def\Dotfill{\leavevmode\cleaders\hb@xt@ .75em{\hss .\hss }\hfill \kern \z@}

\makeatother

\input{../lilypond.ref}




\begin{document}

\titlehead{\fancytitlehead}
\firstname{Friedrich Ludwig Æmilius} % Libretto Jens Immanuel Baggensen
\lastname{Kunzen}
\title{Skabningens Halleluja}
\shorttitle{Skabningens\\Halleluja}
\subtitle{Das Halleluja der Schöpfung\\(DK-Kk mu 6506.1133)}
\instrumentation{2 S, A, T, B (coro), 2 fl, 2 ob, 2 cl, 2 fag, 2 cor, 2 tr, 3 trb, timp,\\vl solo, 2 vl, vla, b}
\maketitle


\thispagestyle{empty}

\vspace*{\fill}

\raisebox{-4mm}{\includegraphics{byncsaeu}}\hspace*{1em}Wolfgang Esser-Skala, 2020

© 2020 by Wolfgang Esser-Skala. This edition is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. To view a copy of this license, visit \url{http://creativecommons.org/licenses/by-nc-sa/4.0/}. 

Music engraving by LilyPond 2.18.0 (\url{http://www.lilypond.org}).\\
Front matter typeset with Source Sans Pro and Fredericka the Great.

\textit{First version, April 2020}

\vspace*{2cm}

\ifprintreport
\chapter*{Critical Report.}

This edition bases upon a manuscript in the Det Kongelige Bibliotek på Slotsholmen – Den Sorte Diamant. The digital version of the manuscript is available at \url{http://img.kb.dk/ma/kunzen/SkaHal_m.pdf} (siglum mu 6506.1133).

In general, this edition closely follows the manuscript. Any changes that were introduced by the editor are indicated by italic type (dynamics and directions), parentheses (expressive marks) or dashes (slurs and ties). Accidentals are used according to modern conventions. Asterisks denote changes that are clarified in the detailed remarks below.

\bigskip

\footnotetext[1]{Abbreviations: A, alto; b, violoncello and bass; B, basso; cl, clarinet; cor, horn; fag, bassoon; ob, oboe; Ms, manuscript; r, rest; S, soprano; T, tenore; timp, timpani; tr, trumpet; trb, trombone; vl, violin; vla, viola.}

\begin{longtable}{lll L{10cm}}
	\toprule
	\itshape Mov. & \itshape Bar & \itshape Staff & \itshape Note \\
	\midrule \endhead
	–  & –   & org   & All bass figures were supplemented by the editor. \\
	1  & 58  & timp  & 2nd half of bar in Ms: c4–c4 \\
	   & 31  & B     & 4th quarter: grace note missing in Ms \\
	\bottomrule
\end{longtable}


This edition has been compiled and checked with utmost diligence. Nevertheless, errors and mistakes cannot be totally excluded. Please report any errors and mistakes to \url{wolfgang@esser-skala.at} or create an issue or pull request on the edition’s GitHub page (https://github.com/skafdasschaf/kunzen-skabningens-halleluja). Your help will be greatly appreciated.

\bigskip
\textit{Salzburg, April 2020\\
Wolfgang Esser-Skala}




\chapter*{Contents. Lyrics.}


\begin{multicols}{2}[\lyref{brichnatur}]
Brich, Natur, in Loblied aus!\\
Lobt Jehoven, alle Zonen,\\
lobet, alle Nationen,\\
lobet Gott!\\
Preiset ihn in vollen Chören,\\[\baselineskip]
Himmel, Erd und Meer!\\
Die ihr athmet, preist den Guten!\\
Ihn, der schuf des Lichtes Gluthen,\\
Ihn, der Odem gab!\\
Hoch in frohe Jubeltöne\\
schweb empor, Gesang, zu Gott!\\
Der gesammten Schöpfung Söhne\\
brechet aus in Jubeltöne,\\
lobet Gott!\\
Der gesammten Schöpfung Söhne\\
singt im heiligsten der Töne,\\
lobet Gott!\columnbreak

\itshape
Bryd, o Støv, i Lovsang ud!\\
Lover Herren alle Zoner!\\
Lover alle Nationer!\\
Lover Gud!\\
Priiser ham, den Eene Store!\\
Priiser Ham i fulde Chore,\\
Himmel, Jord, og Hav!\\
Alt hvad aander, nynne, stamme\\
Ham, som tændte Lysets Flamme!\\
Ham, som Aande gav!\\
Høit i glade Jubeltoner\\
bryde Livets Lovsang [\textit{or}: Vellyst] ud!\\
Alt det Skabtes [\textit{or}: Alle Kloders] Millioner,\\
toner i foreente Toner,\\
toner Gud!
\end{multicols}

\begin{multicols}{2}[\lyref{dieoede}]
Die Öde starrt,\\
von keinem Strahl erhellt,\\
im Schlund der Nacht war Leere, Dunkel, Tod.\\
Da schallt durchs Chaos schaffend dein Gebot:\\
„Sey Welt!“\\
Ein Sonnenheer entsprang aus alter Nacht\\
in Licht hervor.\\
Der Neugeschaffnen Hymne tönt empor:\\
„Halleluja wir leben!\\
Halleluja! du bist! du warst! und bleibest ewig\\
Herr, unser Gott!“\columnbreak

\itshape
Alt hylled laae \textup{[\textit{or}: \textit{slumred dybt}]}\\
i Muelighedens Skiød,\\
i Nattens Svælg var Tomhed, Mørke, Død.\\
Men giennem Evighedens Chaos lød\\
dit Bliv!\\
Og Verdener sprang frem af Intets Skiød\\
til Lys og Liv.\\
Nyskabte Væsners Studsen rundt brød ud:\\
„Halleluja! vi ere!\\
Halleluja! du er, du var, og du skal være\\
vor Gud!”
\end{multicols}


\cleardoublepage
\fi

\iftemplate
\includepdf[pages=-]{../out/\lypdfname.pdf}
\fi



\end{document}